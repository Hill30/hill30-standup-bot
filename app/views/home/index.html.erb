<%
report_messages = [
  'Completed',
  'Working on',
  'Problems'
];
%>

<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-tabs">
  <header class="mdl-layout__header">
    <div class="mdl-layout__tab-bar">
      <a class="mdl-layout__tab" href="?date=<%=  @date-1 %>"> < </a>
      <a class="mdl-layout__tab"><%= @date.to_formatted_s(:long)%></a>
      <a class="mdl-layout__tab"  href="?date=<%=  @date == Date.today ? @date : @date+1 %>"> > </a>
    </div>
    <div>
      <ul>
        <% @teams.each do |t| %>
          <li value="t.id" <%= @team && t.id == @team.id ? 'class="selected"' : '' %>>
            <a href="?date=<%=  @date %>&team=<%= t.id%>">
              <%= t.name %>
            </a>
          </li>
        <% end %>
      </ul>
    </div>
  </header>

  <main class="mdl-layout__content">

    <% if @reports.blank? %>
    <div>
      <% if not @team %>
        Team must be specified.
      <% else %>
        Nothing found for <%=@team.name%> on <%=@date%>.
      <% end %>
    </div>
    <% end %>

    <% if not @reports.blank? %>
    <div class="mdl-grid">
      <% @reports.each do |r| %>
        <div class="mdl-cell mdl-cell--4-col">
          <div class="card-wide mdl-card mdl-shadow--2dp">
            <div class="mdl-card__title">
              <h2 class="mdl-card__title-text"> <%= r.user.email %> </h2>
            </div>
            <div class="mdl-card__supporting-text">
              <% JSON.parse(r.description).each do |k,v| %>
                <% if v.present? %>
                  <b><%= report_messages[k.to_i] %></b><hr>
                  <ul class='mdl-list'>
                    <% v.each do |message| %>
                      <li class=""> - <%= message %> </li>
                    <% end %>
                  </ul>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <% end %>

  </main>
</div>

<% if user_signed_in? %>
  <a href="/logout"
      target="_blank" id="view-source"
      class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-color--accent mdl-color-text--white"
      data-upgraded=",MaterialButton,MaterialRipple">Log out
      <span class="mdl-button__ripple-container">
        <span class="mdl-ripple is-animating" style="width: 255.952px; height: 255.952px; transform: translate(-50%, -50%) translate(26px, 19px);">
        </span>
      </span>
  </a>
<% end %>
